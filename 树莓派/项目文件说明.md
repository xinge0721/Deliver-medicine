# 项目文件说明

本文档详细介绍了本项目中各个文件的功能、用途以及所使用的技术。

## YOLO_detection（核心代码）
这是项目的核心代码，负责使用YOLO（You Only Look Once）算法进行目标检测。

### 技术特点
- **YOLO目标检测算法**：采用Ultralytics YOLOv8架构，实现了高效的单阶段目标检测
- **多线程处理**：使用Python的`threading`模块实现并行处理，提高检测效率
- **多目标跟踪**：通过`GlobalState`类管理全局状态，存储和协调检测结果
- **非极大值抑制(NMS)**：实现了自定义的`apply_nms`函数，消除重复检测框
- **多数表决机制**：通过`majority_vote`函数实现了对多次检测结果的投票统计，提高检测可靠性
- **IoU计算**：使用`calculate_iou`函数计算边界框的交并比，用于目标跟踪和抑制重复检测

## HCSR04_fixed（核心代码）
这是项目的另一核心组件，用于通过HC-SR04超声波传感器实现距离测量功能。

### 技术特点
- **树莓派GPIO控制**：使用`RPi.GPIO`库精确控制GPIO引脚进行信号发送和接收
- **自适应卡尔曼滤波器**：实现了`AdaptiveKalmanFilter`类，显著提高距离测量的准确性和稳定性
  - 支持过程噪声方差动态调整
  - 实现异常值检测算法，自动识别并处理噪声和突变
  - 基于历史数据的自适应参数调整
- **串口通信**：使用`serial`库实现与其他设备的数据交换，波特率115200
- **实时数据处理**：采用NumPy进行高效的数组操作和统计分析
- **异常处理机制**：实现了完善的超时保护、错误处理和资源释放机制
- **数据可视化**：提供运行时的数据统计和波动减少百分比分析

## YOLO_drill（YOLO训练文件）
此文件包含YOLO模型的训练相关代码，用于模型的训练与优化。

### 技术特点
- **深度学习框架**：基于Ultralytics YOLO框架实现的模型训练流程
- **训练参数优化**：使用精心调整的参数配置，包括:
  - 图像大小(imgsz=640)
  - 批次大小(batch=16)
  - 学习率调度
  - 早停机制(patience=50)
- **数据加载优化**：多工作进程(workers=4)实现高效数据加载
- **迁移学习**：利用预训练权重(last.pt)加速模型收敛
- **环境变量配置**：设置必要的环境变量以确保训练稳定性

## test_image（单张图片测试文件）
这是用于测试YOLO目标检测功能的单张图片测试代码，实现了复杂的检测逻辑。

### 技术特点
- **多线程并行检测**：使用Python的`threading`和`queue`模块实现3个并行的检测线程
- **线程同步机制**：通过互斥锁(`threading.Lock`)和事件通知(`threading.Event`)确保线程安全
- **串口通信协议**：实现与外部硬件的信号交互，使用四字节`\xFF\xFF\xFF\xFF`作为启动信号
- **首次检测记忆**：通过`save_first_detection`实现对首次检测结果的存储和后续比对
- **位置判断算法**：`check_and_locate_number`函数通过分析检测对象的中心坐标判断其左右位置
- **结果聚合**：合并多线程检测结果，提高检测的准确性
- **JSON格式化**：使用标准化的数据结构存储和传递检测结果

## Digital_generation（测试图片生成文件）
此文件用于生成测试用的图片数据，主要用于模型训练和评估。

### 技术特点
- **PIL图像处理库**：使用Python Imaging Library进行高质量图像生成
- **九宫格布局设计**：实现3x3网格布局的自动生成算法
- **随机数据生成**：使用Python的`random`模块生成随机数字(0-9)
- **字体渲染兼容性**：多级字体加载机制，支持多种系统字体格式
- **尺寸自适应**：根据A4尺寸(2480x3508像素)自动计算元素位置和大小
- **向后兼容性**：同时支持新旧版本PIL的文本渲染API
- **文件系统管理**：自动创建目录结构，实现文件输出的规范化管理

## camera_test（摄像头测试代码）
这是摄像头功能测试的代码，用于验证系统与摄像头的连接及图像处理功能。

### 技术特点
- **OpenCV图像处理**：使用`cv2`库实现摄像头实时图像的获取和处理
- **YOLO实时检测**：集成Ultralytics YOLO模型实现实时目标识别
- **动态边界框渲染**：为不同类别设置不同颜色，实现可视化边界框和标签
- **多摄像头适配**：具有摄像头自动选择功能，支持多种摄像头设备
- **自适应UI布局**：标签位置根据检测框位置动态调整，确保良好的视觉效果
- **资源管理**：实现了完善的资源释放机制，确保程序正常退出时释放摄像头和窗口资源 